---
title: ChatGPT Shiny R app
author: Package Build
date: '2023-12-22'
slug: []
categories:
  - Programming
tags:
  - Programming
  - R Markdown
type: ''
subtitle: ''
image: ''
---

Simple integration of chatgpt into shiny R.

{The app is hosted at:} <https://twong.shinyapps.io/chat_bot/>



<iframe height="400" width="100%" frameborder="no" 

src="https://twong.shinyapps.io/chat_bot/">

</iframe>


```{r}
library(shiny)
library(httr)

ui <- fluidPage(
  titlePanel("ChatGPT Shiny App"),
  textInput("user_input", "Enter your message:"),
  actionButton("submit_btn", "Submit"),
  textOutput("chat_output")
)

server <- function(input, output, session) {

    conversation_history <- reactiveVal(list())
    
    observeEvent(input$submit_btn, {
      user_message <- isolate(input$user_input)
      conversation <- isolate(conversation_history())
      conversation <- c(conversation, list(list(role = "system", content = "You:")))
      conversation <- c(conversation, list(list(role = "user", content = user_message)))
      
      # Make a request to the OpenAI API
      response <- httr::POST(
        url = "https://api.openai.com/v1/chat/completions",
        add_headers(
          "Content-Type" = "application/json",
          "Authorization" = paste("Bearer", "api_key", sep = " ")
        ),
        body = list(
          model = "gpt-3.5-turbo",
          messages = conversation
        ),
        encode = "json"
      )
      
      # Extract the bot's message from the API response
      #bot_message <- httr::content(response, "text")
      bot_message <- trimws(content(response)$choices[[1]]$message$content)
      conversation <- c(conversation, list(list(role = "assistant", content = bot_message)))
      
      conversation_history(conversation)
      output$chat_output <- renderText({
        bot_message
      })
    })
  }
  

shinyApp(ui, server)
```
